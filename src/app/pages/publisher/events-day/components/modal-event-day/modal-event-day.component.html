<h1 mat-dialog-title>{{data.title}}</h1>
<mat-sidenav-container mat-dialog-content>
  <mat-sidenav [(opened)]="sidenavOpened">
    <mat-card *ngFor="let card of cards" appMaterialElevation (click)="onSelectCard(card)"
              title="Click para seleccionar" class="card" fxLayout="row" fxLayoutGap="12px"
              [innerHTML]="sanitizeHTML(card.texto)">

    </mat-card>
  </mat-sidenav>
  <mat-sidenav-content>
    <div mat-dialog-content>
      <form [formGroup]="eventDayForm.baseForm" fxLayout="row" fxLayoutAlign="space-around center">
        <div *ngIf="!selectCardHTML; else selectedCard" fxFlex="60" class="select-card-container">
          <div class="btn-select-card">
            <button mat-button color="primary" (click)="loadCards()">
              Seleccionar plantilla<br>
              <mat-icon>image</mat-icon>
            </button>
          </div>
          <mat-error *ngIf="checkField('plantilla', null, null)">Seleccione la plantilla</mat-error>
        </div>
        <ng-template #selectedCard>
          <div fxFlex="60" [innerHTML]="selectCardHTML" appMaterialElevation (click)="loadCards(true)"
               class="select-card-container" title='click para cambiar plantilla'></div>
        </ng-template>

        <div fxFlex="38" fxLayout="column">
          <div fxLayout="row" fxLayoutAlign="space-between center">
            <!-- Name -->
            <mat-form-field hideRequiredMarker appearance="outline" fxFlex="47">
              <mat-label>Nombre</mat-label>
              <label>
                <input type="text" matInput required formControlName="nombre">
              </label>
              <mat-icon matSuffix>event_note</mat-icon>
              <!-- <mat-error *ngIf="checkField('nombre', null, null)">El nombre es requerido</mat-error> -->
            </mat-form-field>
            <!-- State -->
            <mat-form-field fxFlex="47" hideRequiredMarker appearance="outline">
              <mat-label>estado</mat-label>
              <mat-select #state formControlName="estado">
                <mat-option>-- Seleccione una opción --</mat-option>
                <mat-option value="ACTIVO">ACTIVO</mat-option>
                <mat-option value="INACTIVO">INACTIVO</mat-option>
              </mat-select>
              <ng-container [ngSwitch]="state.value" matSuffix>
                <mat-icon *ngSwitchCase="'ACTIVO'" matSuffix>notifications_active</mat-icon>
                <mat-icon *ngSwitchCase="'INACTIVO'" matSuffix>notifications_off</mat-icon>
                <mat-icon *ngSwitchDefault matSuffix>edit_notifications</mat-icon>
              </ng-container>
              <!-- <mat-error *ngIf="checkField('estado', null, null)">El estado es requerido</mat-error> -->
            </mat-form-field>
          </div>
          <div fxLayout="row" fxLayoutAlign="space-between center">
            <!-- Start date-->
            <mat-form-field fxFlex="47" appearance="outline">
              <mat-label>Fecha de inicio</mat-label>
              <label>
                <input matInput [matDatepicker]="dp" formControlName="fecha" (dateChange)="setDateFormat($event)"
                       placeholder="YYYY-MM-DD">
              </label>
              <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
              <mat-datepicker #dp></mat-datepicker>
            </mat-form-field>
            <!-- Recurrency -->
            <mat-form-field fxFlex="47" hideRequiredMarker appearance="outline">
              <mat-label>Recurrencia</mat-label>
              <mat-select #recurrency formControlName="recurrencia">
                <mat-option value="">-- Seleccione una opción --</mat-option>
                <mat-option value="ANUAL">ANUAL</mat-option>
                <mat-option value="DIARIA">DIARIA</mat-option>
              </mat-select>
              <ng-container [ngSwitch]="recurrency.value" matSuffix>
                <mat-icon *ngSwitchCase="'ANUAL'" matSuffix>more_time</mat-icon>
                <mat-icon *ngSwitchCase="'DIARIA'" matSuffix>update</mat-icon>
                <mat-icon *ngSwitchDefault matSuffix>schedule</mat-icon>
              </ng-container>
            </mat-form-field>
          </div>
          <!-- Conditions -->
          <div formArrayName="condicionesEvento"
               *ngFor="let condition of eventDayForm.conditionsOptionsField.controls; let i=index" fxLayout="row"
               fxFlexAlign="space-between center">
            <div fxFlex="70" [formGroupName]="i">
              <mat-form-field hideRequiredMarker fxFlex="90" appearance="outline">
                <mat-label>Condiciones</mat-label>
                <mat-select formControlName="condicion"
                            (selectionChange)="setformGroupField(condition, $event.value, i)">
                  <mat-option>-- Seleccione una opción --</mat-option>
                  <mat-option *ngFor="let condition of conditions" [value]="condition.condicion">
                    <ng-container> {{condition.condicion}} </ng-container>
                  </mat-option>
                </mat-select>
                <mat-icon matSuffix>fact_check</mat-icon>
              </mat-form-field>
            </div>
            <!-- Actions list -->
            <div fxFlex="25" fxLayout="row" fxFlexAlign="space-around center">
              <div *ngIf="eventDayForm.baseForm.controls.condicionesEvento.value.length>1" fxFlex="45">
                <button mat-mini-fab color="warn" title="Eliminar condición" (click)="eventDayForm.removeCondition(i)">
                  <mat-icon>remove</mat-icon>
                </button>
              </div>
              <div
                *ngIf="eventDayForm.baseForm.controls.condicionesEvento.value.length<5 && eventDayForm.baseForm.controls.condicionesEvento.value.length === i+1"
                fxFlex="45">
                <button mat-mini-fab color="primary" title="Agregar condición"
                        (click)="eventDayForm.addConditionsOptions()">
                  <mat-icon>playlist_add</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>

<div mat-dialog-actions fxLayout="row" fxLayoutAlign="end end">
  <button mat-raised-button fxFlex="20" color="warn" (click)="onClose(null)">Cancelar</button>
  <button mat-raised-button fxFlex="20" color="primary" (click)="onSave()">Crear evento</button>
</div>
